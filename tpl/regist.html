<!DOCTYPE HTML>
<html>

<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>注册</title>
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="shortcut icon" type="image/x-icon" href="/app/Tpl/ve_2_1/vetpl/Style/Css/img/favicon.ico">
<link href="/app/Tpl/ve_2_1/vetpl/Style/Css/ve_register.css" rel="stylesheet" type="text/css">
</head>
<body>
<!--header-->
<div id="header" class="response">
    <div class="container clear">
        <div class="logo">
            <a href="http://www.ve.cn"><img src="/app/Tpl/ve_2_1/vetpl/Style/Css/img/ve_logo2015.png" alt="唯一优品"></a>
        </div>
        <div class="server-tip">
            <ul class="clear">
                <li class="serv-t1">
                    <a target="_blank" href="/index.php?ctl=support#zpbz"><i class="icon-serv1"></i><span>100%正品保证</span></a>
                </li>
                <li class="serv-t2">
                    <a target="_blank" href="/index.php?ctl=support#14th"><i class="icon-serv2"></i><span>14天无理由退货</span></a>
                </li>
                <li class="serv-t3">
                    <a target="_blank" href="http://www.ve.cn/help-13.html"><i class="icon-serv3"></i><span>中华财险承保</span></a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--header end-->
<!--main-->
<div id="main">
    <div class="container bg-reg clear">
        <div class="reg-content">
            <div class="regForm">
                <div class="reg-title register-tit response_title" >
                    <span>已有唯一账号<a href="index.php?ctl=user&act=login" class="c-regitem1">登录</a></span>
                    <h2>注&nbsp;册</h2>
                </div>
                <!-- form -->
                <form action="#" method="post"  id="formreg">
                    <div class="formitm">
                        <div class="form-item">
                            <p class="inputs">
                                <input type="text" class="u-ipt" id="username" name="username" >
                                <label for="" class="u-placeholder">邮箱或手机号</label>
                            </p>
                            <p id="username-tip" class="u-tip">请输入正确的邮箱或手机号</p>
                            <div id="username-poptip" class="auth-tips">
                                <div class="auto-tip-c">
                                    <i class="icon-ltip"></i>
                                    <span>请输入邮箱或者手机号码</span>
                                </div>
                            </div>
                        </div>
                        <div id="m_verify" class="form-item hide">
                            <div class="phone-box clear">
                                 <p class="inputs">
                                    <input type="text" class="u-ipt u-phone-code fl" id="mverify" name="mverify">
                                    <label for="" class="u-placeholder">请输入手机验证码</label>
                                </p>
                                <a href="javascript:;" class="btn-send-msg">发送</a>
                                <!-- <a href="" class="btn-send-msg u-wait hide">60s</a> -->
                            </div>
                            <p id="u-tip" class="u-tip">请输入正确手机验证码</p>
                        </div>
                        <div class="form-item">
                             <p class="inputs">
                                <input type="password" class="u-ipt" id="password" name="password">
                                <label for="" class="u-placeholder">密码</label>
                            </p>
                            <div class="pwd-box clear">
                                <label class="pwdstrength" id="pwdstrength">
                                    <span class="fl">安全程度：</span>
                                </label>
                                <div class="pwdstr-item">   <!-- 用strengthA  strengthB strengthC 进行样式控制-->
                                    <span class="pwd-item1">弱</span>
                                    <span class="pwd-item2">中</span>
                                    <span class="last pwd-item3">强</span>
                                </div>
                            </div>
                            <p id="password-tip" class="u-tip">请正确输入8～20位密码</p>
                            <div id="password-poptip" class="auth-tips">
                                <div class="auto-tip-c">
                                    <i class="icon-ltip"></i>
                                    <span>请输入8～20位密码</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-item">
                             <p class="inputs">
                                <input type="password" class="u-ipt" id="repassword" name="repassword">
                                <label for="" class="u-placeholder">确认密码</label>
                            </p>
                            <p id="repassword-tip" class="u-tip">两次输入密码不一致</p>
                        </div>
                        

                        {if $is_add_baby eq 1} 
                        <div class="form-item form-item-check response">
                             <div class="check-sel">
                                  <label class="check-lab">宝宝性别：</label>
                                  <div class="check-box">
                                      <label><input class="child" type="radio" name="child" value="1" checked="checked"><span>公主</span></label>
                                      <label><input class="child" type="radio" name="child" value="2"><span>王子</span></label>
                                      <label><input class="child" type="radio" name="child" value="3"><span>孕期</span></label>
                                  </div>
                             </div>
                        </div>
                        <div class="form-item response">
                             <p class="inputs">
                                <input type="text" class="u-ipt" id="birthday" name="birthday">
                                <label for="" class="u-placeholder">宝宝出生日期</label>
                            </p>
                            <p id="birthday-tip" class="u-tip">请输入正确的宝宝生日, 如：2015-01-01或者2015.1.1</p>
                            <div id="birthday-poptip" class="auth-tips">
                                <div class="auto-tip-c">
                                    <i class="icon-ltip"></i>
                                    <span>请输入宝宝出生日期</span>
                                </div>
                            </div>
                        </div>
                        {/if}
                        


                        <div class="form-item clear">
                             <p class="inputs">
                                <input type="text" class="u-ipt u-verCode" id="verify" name="verify">
                                <label for="" class="u-placeholder">输入验证码</label>
                            </p>
                            <a class="verifyCode"><img id="verify_image1" width="90" height="36" src="verify.php?rand=1421910593274"></a>
                            <a class="changeCode" href="javascript:;">换一张</a>
                             <p id="verify-tip" class="u-tip">请输入正确验证码</p>
                        </div>
                        <div class="form-item pblast">
                            <input class="submit-btn" type="button" value="注&nbsp;册">
                            <span class="p-server">我已阅读并接受 <a href="" class="c-regitem1">唯一优品服务条款</a></span>
                        </div>
                    </div>
                </form>
                <!-- form end -->
            </div>
        </div>
    </div>
</div>
<!--main end -->
<!--footer-->
<div id="footer" class="response">
    <div class="container">
        <p class="copyright">Copyright © 2014 ve.cn  广州唯伊特卖电子商务有限公司  版权所有  粤ICP备14068931号-1  使用本网站即表示接受唯一用户协议</p>
        <p class="foot-kf">全国客服服务热线（7*13小时）: 400-616-1111</p>
    </div>
</div>
<!--footer end-->
<script type="text/javascript">        
        var is_add_baby = "{$is_add_baby}";
        if (top.location != self.location){
                is_add_baby = 0;
        }
        var mobile_url = '{url r="user#sendmsg"}';
        var mobile_post_url= '{url r="user#mobileregister"}';
        var pc_post_url= '{url r="user#doregister"}';
        var register_pid = '{$pid}';
</script>
 <script src="/app/Tpl/ve_2_1/vetpl/Script/Jquery.1.8.3.min.js"></script>
<script src="/app/Tpl/ve_2_1/vetpl/public/script/vecommon.js" type="text/javascript"></script>
<script src="/app/Tpl/ve_2_1/vetpl/public/script/jquery.base64.js" type="text/javascript"></script>
<script>
        //页面注册数据
        var 
        __form_reg = $('#formreg'),   //form
        __f = __form_reg[0],
        chk={};
        chk.username={}; 
        chk.ultimate={};   //store async check state for ultimate submit

        //校验函数
        var formValide = form_valide;

        //页面数据
        function getFormData(){
                var 
                form_data = {
                      'username' :  { 'ipt' : __f['username'],'tip':$('#username-tip'), 'ptip':$('#username-poptip') }
                    , 'mverify' : { 'ipt' : __f['mverify'],'tip':$('#u-tip'), 'ptip':'' }
                    , 'password' : { 'ipt' : __f['password'],'tip':$('#password-tip'), 'ptip': $('#password-poptip') } 
                    , 'repassword' : { 'ipt' : __f['repassword'],'tip':$('#repassword-tip'), 'ptip':'' } 
                    , 'child' : { 'ipt' : __f['child'],'tip':$('#username-tip'), 'ptip':'' } 
                    , 'birthday' : { 'ipt' : __f['birthday'],'tip':$('#birthday-tip'), 'ptip':$('#birthday-poptip') } 
                    , 'verify' : { 'ipt' : __f['verify'],'tip':$('#verify-tip'), 'ptip':'' } 
                }

                var
                ifr_form_data = {
                      'username' :  { 'ipt' : __f['username'],'tip':$('#username-tip'), 'ptip':$('#username-poptip') }
                    , 'mverify' : { 'ipt' : __f['mverify'],'tip':$('#u-tip'), 'ptip':'' }
                    , 'password' : { 'ipt' : __f['password'],'tip':$('#password-tip'), 'ptip': ''} 
                    , 'repassword' : { 'ipt' : __f['repassword'],'tip':$('#repassword-tip'), 'ptip':'' } 
                    , 'child' : { 'ipt' : __f['child'],'tip':$('#username-tip'), 'ptip':'' } 
                    , 'birthday' : { 'ipt' : __f['birthday'],'tip':$('#birthday-tip'), 'ptip':'' } 
                    , 'verify' : { 'ipt' : __f['verify'],'tip':$('#verify-tip'), 'ptip':'' } 
                }

                if (top.location != self.location){
                        return ifr_form_data;
                }
                return form_data;
        }

        /*
        *  校验开始
        *  规则
        *  校验
        */        
         //custom rule to replace default rule
        var chkopts = {            
                username: function(input_obj,reg){   // username 长度大于8，小于20
                        var 
                        iobj = input_obj,
                        ipt = iobj.ipt,
                        val = iobj.ipt.value,
                        tmp = reg.email.test(val);    //email check

                        if(tmp) chk['username']['type'] = 'email';
                        // not email
                        if(!tmp) {
                                tmp = reg.mobile.test(val);   //mobile check
                                if(tmp)
                                        chk['username']['type'] = 'mobile';
                        }
                        return tmp;
                },
                password: function(input_obj,reg){
                        var 
                        iobj = input_obj,
                        ipt = iobj.ipt,
                        val = iobj.ipt.value,
                        tmp = true,
                        level = (val.length>7) ? 0 + (val.length>7) + (/[a-z]/.test(val) && /[A-Z]/.test(val)) + (/\d/.test(val) && /\D/.test(val)) + (/\W/.test(val) && /\w/.test(val)) + (val.length > 12) : 0;  //level  0  1  2  3  4  password stronger
                        if(val.length>20||/\s/.test(val)) level=0; //不包括空格
                        if(level==0||!level){
                                tmp = false;
                        }
                        chk['password']={};
                        chk['password']['level']=level;
                        return tmp;
                },
                repassword: function(input_obj,reg){
                        var 
                        pobj = input_obj[0],   //password object
                        pipt = pobj.ipt;
                        pval = pipt.value,

                        iobj = input_obj[1],    //repassword object
                        ipt = iobj.ipt,
                        val = iobj.ipt.value,
                        tmp = true;

                        if(val!==pval)
                                tmp = false;

                        return tmp;
                },
                birthday: function(input_obj,reg){
                        var 
                        cobj = input_obj[0],   //child object
                        cipt = cobj.ipt;
                        cval = cipt.value,

                        iobj = input_obj[1],    //birthday object
                        ipt = iobj.ipt,
                        val = ipt.value,
                        tmp = true;

                        tmp = reg.birthday.test(val);    //birthday check
                        if(tmp){                                
                                if(!cval)
                                        tmp=false;
                        }
                        return tmp;
                }
        }

        //预处理
        var __pre = function(name,api,cb){                
                var opts = {};
                opts[name] = api;
                opts[null] = [cb];
                init(chk,opts);
        }

        //预处理回调
        var __aft = {
                'username' : function(){
                        var 
                        tmp = true;
                        inputs = getFormData(),
                        ipt = inputs['username']['ipt'];
                        tip = inputs['username']['tip'];
                        if(chk['pre_username']){
                                var ajaxdata = chk['pre_username'];
                                if(ajaxdata.status<0) {
                                        tmp=false;
                                        $(tip).addClass('show');
                                } else{
                                        switch(ajaxdata.status){
                                                case 0 :
                                                        $(ipt).addClass('u-verified');
                                                break;                                        
                                                case  1 :
                                                        $(tip).html('邮箱已被注册').addClass('show');
                                                        $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                                                break;
                                                case  2 :
                                                        $(tip).html('手机已被注册').addClass('show');
                                                        $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                                                break;                                                
                                        }
                                }
                                if(ajaxdata.status!=0)  tmp=false;
                                else {
                                    tmp=true;
                                    if(chk['ultimate']['submit']){
                                            //submit register
                                            do_action('delaySubmit');
                                    }
                                }
                        }
                        chk['ultimate']['username'] = tmp;
                        return tmp;
                },
                'sendmsg' : function(){                       
                        if(chk['pre_sendmsg']){
                                var data = chk['pre_sendmsg'];
                                tips(data['msg']);
                                // $('.changeCode').trigger('click');
                        }
                },
                'pcregister' : function(){                       
                        if(chk['pre_pcregister']){
                                var data = chk['pre_pcregister'];
                                tips(data['info']);
                                //iframe
                                if (top.location != self.location){
                                        top.location.href=data.jump;        
                                }else{
                                        window.location.href=data.jump;
                                }
                        }
                },
                'mobregister' : function(){                       
                        if(chk['pre_mobregister']){
                                var data = chk['pre_mobregister'];
                                tips(data['info']);
                                if (top.location != self.location){
                                        top.location.href=data.jump;        
                                }
                                window.location.href=data.jump;
                                // $('.changeCode').trigger('click');
                        }
                },
                'verify' : function(){
                        var 
                        tmp = true;
                        inputs = getFormData(),
                        ipt = inputs['verify']['ipt'];
                        tip = inputs['verify']['tip'];
                        if(chk['pre_verify']){
                                var data = chk['pre_verify'];
                                if(data.status!=0){
                                        $(tip).addClass('show');
                                        $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                                        $('.changeCode').trigger('click');
                                        tmp=false;
                                }else{
                                        tmp=true;
                                        chk['ultimate']['verify'] = tmp;
                                        if(chk['ultimate']['submit']){                                                
                                                //submit register
                                                do_action('delaySubmit');
                                        }
                                }
                        }
                        chk['ultimate']['verify'] = tmp;
                        return tmp;
                }
        }        

        //after validate input value then exec this function
        // this function implementation  interactive effect, like some tips, pop-msg
        function tipBehavior(name,booler){
                var
                inputs = getFormData(),
                ipt = inputs[name] ? inputs[name]['ipt'] : '',
                tip = inputs[name] ? inputs[name]['tip'] : '';
                ptip = inputs[name] ? inputs[name]['ptip'] : '';

                //public tip method
                function commonTip(msg){
                        if(booler){
                                $(ipt).removeClass('u-error').removeClass('u-verified-err').addClass('u-verified');
                                $(tip).removeClass('show');
                                $(ptip).removeClass('show');
                                $('.auth-tips-top').addClass('hide');
                        }else{
                                $('.auth-tips-top').addClass('hide');
                                msg ? $(tip).html(msg).addClass('show') : $(tip).addClass('show') 
                                $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                        }
                }

                //keyup event will trigged this function, it wile generate the password strength
                function intimePasswordBehavior(lev){                        
                        if(lev>=1){
                                $('.pwdstr-item').removeClass('strengthB').removeClass('strengthC');
                                $('.pwdstr-item').addClass('strengthA');
                        }
                        if(lev>2){
                                $('.pwdstr-item').removeClass('strengthA').removeClass('strengthC');
                                $('.pwdstr-item').addClass('strengthB');
                        }
                        if(lev>=4){
                            $('.pwdstr-item').addClass('strengthC');
                        }
                }

                if(name=='username'){
                        commonTip('请输入正确的邮箱或手机号');
                        if(booler){
                                chk['username']['type']=='mobile'  ? $('#m_verify').removeClass('hide') : $('#m_verify').addClass('hide');

                                //  if  chk['ultimate']['submit']=true , the submit opration right will change to async callback, 
                                //  the function in __aft['xxx']
                                chk['ultimate']['username'] = false;
                                chk['ultimate']['submit']=false;

                                //get data from back-end that to deal with
                                api = {url:'/',data:{'ctl':'ajax' , 'act':'check_email_and_mobile' , 'email' : ipt.value, 'type':chk['username']['type'] ,'async' : false}};
                                __pre('pre_username', api, __aft['username']); 

                                //send mobile verify code
                                $('.btn-send-msg').bind('click',function(){
                                         if(!chk['msg-sendding'])
                                                 $(inputs['verify']['ipt']).trigger('blur',[true,ipt.value]);
                                });
                        }else{
                                $('#m_verify').addClass('hide');
                        }
                }
                if(name=='mverify'){
                        commonTip();
                }
                //in-time get password level
                if(name=='intime_password'){
                        if(chk['password']['level']){
                                var 
                                flag = chk['password']['level'];
                                flag>=4 
                                    ? intimePasswordBehavior(4)
                                    : flag>2 
                                            ? intimePasswordBehavior(3)
                                            :  flag>=1 
                                                    ? intimePasswordBehavior(1)
                                                    :  $('.pwdstr-item').removeClass('strengthA').removeClass('strengthB').removeClass('strengthC');
                        }else{
                                $('.pwdstr-item').removeClass('strengthA').removeClass('strengthB').removeClass('strengthC');
                        }
                }                
                if(name=='password'){                        
                        commonTip();                        
                        if(inputs['repassword']['ipt'].value){
                                $(inputs['repassword']['ipt']).trigger('blur');
                        }
                }
                if(name=='repassword'){
                        commonTip();
                }
                if(name=='birthday'){
                        commonTip();
                }
                if(name=='verify'){
                        commonTip();
                        if(booler){
                                
                                //  if  chk['ultimate']['submit']=true , the submit opration right will change to async callback, 
                                //  the function in __aft['xxx']
                                chk['ultimate']['verify'] = false;
                                chk['ultimate']['submit']=false;

                                //get data from back-end that to deal with
                                api = {url:'/',data:{'ctl':'ajax' , 'act':'check_email_and_mobile' , 'verify' : ipt.value ,'async' : false}};
                                __pre('pre_verify', api, __aft['verify']); 
                        }
                }
               
        }

        /*
        *  bind input element default event method
        *  click, blur, keyup
        */
        function bindInputDefaultEvent(){
                var 
                inpt,
                tmp,
                inputs = getFormData();

                //verify code refrash
                $('.changeCode').bind('click',function(){
                        var timenow = new Date().getTime();
                        $('#verify_image1').attr("src", "verify.php?rand=" + timenow);
                });

                // .u-ipt is css class of input
                $('.u-ipt').bind('focus',function(){
                        $(this).siblings('.u-placeholder').addClass('hide');
                });
                $('.u-ipt').bind('blur',function(){                        
                        if(!this.value)
                                $(this).siblings('.u-placeholder').removeClass('hide');
                });
                // input prompt
                $('.u-placeholder').click(function(){
                        $(this).siblings('.u-ipt').trigger('focus');
                });
                
                for(var ipt in inputs){                        
                        if(ipt=='child') continue;
                        // var inpt = inputs[ipt]['ipt'];                        

                        //
                        (function(ele){
                                var 
                                ipt = inputs[ele]['ipt'],
                                tip =    inputs[ele]['tip'],
                                ptip = inputs[ele]['ptip'],
                                api ;

                                //refresh this page will empty input value
                                ipt.value='';

                                //default click opration, will show info
                                $(ipt).bind('click',function(){
                                        $('.auth-tips').removeClass('show');
                                        $('.auth-tips-top').removeClass('show');
                                        if(ptip!==''){
                                                ptip.addClass('show');
                                                $('.auth-tips-top').removeClass('hide');
                                        }
                                });                                

                                // default blur opration,  check input value
                                //  < username >, < verify>,  will deal with some async data, and then exec some function in __aft['xxx'];
                                if(ele=='username'){
                                        //blur  behavior  will  valide form then check back-end data and deal with
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide(chkopts)
                                               (inputs[ele],'username')
                                               ();
                                                //valide behavior
                                                tipBehavior('username',tmp);
                                        });
                                }
                                if(ele=='mverify'){
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide({'popmsg':false})
                                               (ipt.value,'verify_m')
                                               ();
                                               //valide behavior
                                               tipBehavior('mverify',tmp);
                                        });
                                }
                                if(ele=='password'){
                                        $(ipt).bind('keyup',function(){
                                               //form valide
                                               tmp = formValide(chkopts)
                                               (inputs[ele],'password')
                                               ();
                                               //valide behavior
                                               tipBehavior('intime_password',tmp);
                                        });
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide(chkopts)
                                               (inputs[ele],'password')
                                               ();
                                               //valide behavior
                                               tipBehavior('password',tmp);
                                        });
                                }
                                if(ele=='repassword'){
                                        var pwd_item = inputs['password'];
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide(chkopts)
                                               ([ pwd_item, inputs[ele] ],'repassword')
                                               ();
                                               //valide behavior
                                               tipBehavior('repassword',tmp);
                                        });
                                }
                                if(is_add_baby==1){
                                        if(ele=='birthday'){
                                                var chd_item = inputs['child'];
                                                $(ipt).bind('blur',function(){
                                                        //form valide
                                                       tmp = formValide(chkopts)
                                                       ([ chd_item, inputs[ele] ],'birthday')
                                                       ();
                                                       //valide behavior
                                                       tipBehavior('birthday',tmp);                                                       
                                                });
                                        }
                                }
                                if(ele=='verify'){
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide({'popmsg':false})
                                               (ipt.value,'verify')
                                               ();
                                               //valide behavior
                                               tipBehavior('verify',tmp);

                                               //send mobile message
                                               if(arguments.length>1){

                                                        //
                                                        var sendmsg = arguments[1];
                                                        var phone = arguments[2];
                                                        if(sendmsg && phone && tmp){
                                                                var that = $('.btn-send-msg');
                                                                 that.addClass('u-wait');
                                                                 
                                                                 // countdown 60 seconds
                                                                 var count = 60;
                                                                 chk['msg-sendding'] = true;   // start countdown trigger, if true, user cannot send message for mobile
                                                                 chk['ttt'] = setInterval(function(){
                                                                        that.html(--count);
                                                                        if(count==0){
                                                                                clearInterval(chk['ttt']);
                                                                                chk['msg-sendding'] = false;  // user can send message again;
                                                                                $('.btn-send-msg').removeClass('u-wait').html('重新发送');
                                                                        }
                                                                 }, 1000);                                                                 

                                                                //send message to user phone;
                                                                api = {url:mobile_url , data:{'mobile':phone , 'code':ipt.value , 'async' : false}};
                                                                __pre('pre_sendmsg', api, __aft['sendmsg']);
                                                       }
                                               }
                                        });
                                }
                        })(ipt);
                }
        } 



        //bind method (click, blur)   first
       bindInputDefaultEvent();

       //ultimate submit   second
       function checkAndPostForm(){
                var 
                inputs = getFormData(),
                user_type = true,
                tmp_type = true;
                if(is_add_baby==1){
                        user_type = formValide(chkopts)
                                                                     (inputs['username'], 'username')
                                                                     (inputs['password'],'password')
                                                                     ([ inputs['password'], inputs['repassword'] ],'repassword')
                                                                     ([ inputs['child'], inputs['birthday'] ],'birthday')
                                                                     ();
                }else{
                        user_type = formValide(chkopts)
                                                                     (inputs['username'], 'username')
                                                                     (inputs['password'],'password')
                                                                     ([ inputs['password'], inputs['repassword'] ],'repassword')
                                                                     ();
                }
                tmp_type = user_type;
                if(chk['username']['type']=='mobile'){
                        user_type = formValide({'popmsg':false})
                                                                      (inputs['mverify']['ipt'].value,'verify_m')
                                                                      (inputs['verify']['ipt'].value,'verify')
                                                                      ();
                }else{
                        user_type = formValide({'popmsg':false})
                                                                      (inputs['verify']['ipt'].value,'verify')
                                                                      ();
                }

                if(user_type&tmp_type){
                         //wait for async opration 600 millisecond, if over 600 millisecond, please check your network
                         function delaySubmit(){
                                var tmp = true;                                 

                                //check async data;
                                for(var stat  in chk['ultimate']){                                        
                                       if(!chk['ultimate'][stat])
                                               tmp = false;
                                }
                                if(tmp){
                                        do_action('register');  //post data
                                }                               
                         }
                         setTimeout(delaySubmit, 600);
                         add_action('delaySubmit',delaySubmit);
                         
                }else{
                        tips('请正确填写注册信息', 'alert');
                        $('.changeCode').trigger('click');
                }
       }

       //submit form to back-end
       function submitUser(){
                var 
                inputs = getFormData(),
                user_type = true,
                tmp_type = true;
                
                // mobile
                if(chk['username']['type']=='mobile'){
                        var query={
                                mobile              : inputs['username']['ipt'].value,
                                mobile_pwd    : $.base64.encode(inputs['password']['ipt'].value),
                                mobile_pwd_confirm  :  $.base64.encode(inputs['repassword']['ipt'].value),
                                verify                 : inputs['verify']['ipt'].value,
                                check_mobile : inputs['mverify']['ipt'].value,
                                pid                     : register_pid,
                                child                  : inputs['child']['ipt'].value,
                                birthday          : inputs['birthday']['ipt'].value,
                                ajax                    :1
                        };
                        api = {"url" : mobile_post_url, data : query };
                        __pre('pre_mobregister',api,__aft['mobregister']);
                 }

                 // pc
                 else{
                        var query={
                                email            : inputs['username']['ipt'].value,
                                user_name : inputs['username']['ipt'].value,
                                user_pwd    : $.base64.encode(inputs['password']['ipt'].value),
                                user_pwd_confirm:$.base64.encode(inputs['repassword']['ipt'].value),
                                verify            : inputs['verify']['ipt'].value,
                                child                  : inputs['child']['ipt'].value,
                                birthday          : inputs['birthday']['ipt'].value,
                                ajax               :1
                        };
                        api = {"url" : pc_post_url, data : query };                                
                        __pre('pre_pcregister',api,__aft['pcregister']);
                 }
        }
        add_action('register', submitUser);

        //校验
       $('.submit-btn').click(function(){
                //change the submit opration right to __aft['xxx']  function
                chk['ultimate']['submit']=true;

                checkAndPostForm();
       });
        
        //iframe
        if (top.location != self.location){
                $('.container').removeClass('container').removeClass('bg-reg');
                $('.reg-content').removeClass('reg-content').css({'float':'none','width':'326px'});
                $('.auth-tips:first').removeClass('auth-tips').addClass('auth-tips-top');
                $('.auth-tips-top').addClass('hide');
                $('.response').hide();
                $('.response_title').removeClass('reg-title').removeClass('register-tit').html('').css('height','35px');
                $('#main').css('background','none')
       }



</script>
</body>
</html>