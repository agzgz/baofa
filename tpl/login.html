<!DOCTYPE HTML>
<html>

<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>登录</title>
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="shortcut icon" type="image/x-icon" href="/app/Tpl/ve_2_1/vetpl/Style/Css/img/favicon.ico">
<link href="/app/Tpl/ve_2_1/vetpl/Style/Css/ve_register.css" rel="stylesheet" type="text/css">
<script type="text/javascript">
        var login_url = '{url r="user#dologin"}' ;
</script>
</head>
<body>
<!--header-->
<div id="header" class="response">
    <div class="container clear">
        <div class="logo">
            <a href="http://www.ve.cn"><img src="/app/Tpl/ve_2_1/vetpl/Style/Css/img/ve_logo2015.png" alt="唯一优品"></a>
        </div>
        <div class="server-tip">
            <ul class="clear">
                <li class="serv-t1">
                    <a target="_blank" href="/index.php?ctl=support#zpbz"><i class="icon-serv1"></i><span>100%正品保证</span></a>
                </li>
                <li class="serv-t2">
                    <a target="_blank" href="/index.php?ctl=support#14th"><i class="icon-serv2"></i><span>14天无理由退货</span></a>
                </li>
                <li class="serv-t3">
                    <a target="_blank" href="http://www.ve.cn/help-13.html"><i class="icon-serv3"></i><span>中华财险承保</span></a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--header end-->
<!--main-->
<div id="main">
    <div class="container bg-reg clear">
        <div class="reg-content">
            <div class="regForm login-box">
                <div class="reg-title register-tit response_title">
                    <span><a href="/index.php?ctl=user&act=register" class="c-regitem1">免费注册</a></span>
                    <h2>登&nbsp;录</h2>
                </div>
                <!-- form -->
                <form id="login-form" action="#" method="post" >
                    <div class="formitm">
                        <div class="login-tips">
                            <span class="lo-tips u-error hide">请输入正确的邮箱或手机号</span>
                        </div>
                        <div class="form-login">
                             <p class="form-login-item form-login-user">
                                <input name='username' id='username' type="text" class="u-ipt">
                                <i class="icon-item icon-user"></i>
                                <label for="" class="u-placeholder">手机号/邮箱</label>
                            </p>
                             <p class="form-login-item">
                                <input name="password" id="password" type="password" class="u-ipt">
                                <i class="icon-item icon-lock"></i>
                                <label for="" class="u-placeholder">密码</label>
                            </p>
                        </div>
                        <div id="verify-filed" class="form-item clear hide">   <!--  如果出现验证码就在其 regForm里加类login-code -->
                             <p class="inputs">
                                <input name="verify" id="verify" type="text" class="u-ipt u-verCode">
                                <label for="" class="u-placeholder">输入验证码</label>
                            </p>
                            <a class="verifyCode"><img id="verify_image1" width="90" height="36" src="http://www.ve.cn/verify.php?rand=1421910593274"></a>
                            <a class="changeCode" href="javascript:;">换一张</a>
                            <p id="verify-tip" class="u-tip">请输入验证码</p>
                        </div>
                        <div class="form-item form-item-agree">
                             <p class="pass_org">
                                <a href="/index.php?ctl=resetpwd&act=username" class="fr c-regitem1">忘记密码?</a>
                                <label for="agree_userterm"><input name="agree_userterm" id="agree_userterm" class="agree-check" checked="" type="checkbox" value="1"><span>自动登录</span></label>
                            </p>
                        </div>
                        <div class="form-item">
                            <input class="submit-btn btn-login" type="button" value="登&nbsp;录">
                        </div>
                    </div>
                </form>
                <!-- form end -->
                <!-- 更多登录 -->
                <div class="m-linkBox">
                    <div class="linkBoxTitle clear">
                        <span class="fl">合作账号登录：</span>
                        <div class="login-item">
                            <a title="新浪微博" href="{url x="apilogin#login" p="type=sina"}#f=login&md={$MODULE_NAME}" target="_blank" class="iconLinks sina" mars_sead="passport_bottom_weibo_button"></a>
                            <a href="{url x="apilogin#login" p="type=qq"}#f=login&md={$MODULE_NAME}" title="QQ" target="_blank" class="iconLinks qq" mars_sead="passport_bottom_qq_button"></a>
                            <a href="{url x="apilogin#login" p="type=weixin"}#f=login&md={$MODULE_NAME}" target="_blank" title="微信" class="iconLinks weixin" mars_sead="passport_bottom_alipay_button"></a>
                            <!-- <a href="{url x="apilogin#login" p="type=alipay"}#f=login&md={$MODULE_NAME}" target="_blank" title="支付宝" class="iconLinks alipay" mars_sead="passport_bottom_alipay_button"></a> -->
                            <a href="http://www.ve.cn/apilogin-login/type-alipay.html#f=login&md=user" target="_blank" title="支付宝" class="iconLinks alipay" mars_sead="passport_bottom_alipay_button"></a>
                            <a class="plusLink" href="javascript:;" data-act="showMoreLinks">更多 <i></i></a>
                        </div>
                    </div>
                    <div class="moreLinksBox hide">
                        <a href="{url x="apilogin#login" p="type=kaixin"}#f=login&md={$MODULE_NAME}" class="span1" mars_sead="passport_bottom_happy_button" title="开心网" target="_blank">开心</a><span>|</span>
                        <a href="{url x="apilogin#login" p="type=renren"}#f=login&md={$MODULE_NAME}" class="span1" mars_sead="passport_bottom_happy_button" title="人人网" target="_blank">人人网</a><span>|</span>
                        <a href="{url x="apilogin#login" p="type=wangyi"}#f=login&md={$MODULE_NAME}" class="span1" mars_sead="passport_bottom_happy_button" title="网易" target="_blank">网易</a>
                    </div>
                </div>
                <!-- 更多登录 end-->
            </div>
        </div>
    </div>
</div>
<!--main end -->
<!--footer-->
<div id="footer" class="response">
    <div class="container">
        <p class="copyright">Copyright © 2014 ve.cn  广州唯伊特卖电子商务有限公司  版权所有  粤ICP备14068931号-1  使用本网站即表示接受唯一用户协议</p>
        <p class="foot-kf">全国客服服务热线（7*13小时）: 400-616-1111</p>
    </div>
</div>
<!--footer end-->
 <script src="/app/Tpl/ve_2_1/vetpl/Script/Jquery.1.8.3.min.js"></script>
<script src="/app/Tpl/ve_2_1/vetpl/public/script/vecommon.js" type="text/javascript"></script>
<script src="/app/Tpl/ve_2_1/vetpl/public/script/jquery.base64.js" type="text/javascript"></script>
<script>

        //页面注册数据
        var 
        __form_log = $('#login-form'),   //form
        __f = __form_log[0],
        login={};
        login.ultimate={};  //store async check state for ultimate submit

         //校验函数
        var formValide = form_valide;

        //页面数据
        function getFormData(){
                var 
                form_data = {
                      'username' :  { 'ipt' : __f['username'],'tip' : $('.lo-tips')[0], 'ptip' : '' }
                    , 'password' : { 'ipt' : __f['password'],'tip' : '', 'ptip': '' }
                    , 'verify' : { 'ipt' : __f['verify'],'tip' : $('#verify-tip'), 'ptip':'' } 
                }
                return form_data;
        }

        /*
        *  校验开始
        *  规则
        *  校验
        */        
         //custom rule to replace default rule
        var chkopts = {            
                username: function(input_obj,reg){   // username 长度大于8，小于20
                        var 
                        iobj = input_obj,
                        ipt = iobj.ipt,
                        val = iobj.ipt.value,
                        tmp = reg.email.test(val);    //email check

                        login['username']={};
                        if(tmp) login['username']['type'] = 'email';
                        // not email
                        if(!tmp) {
                                tmp = reg.mobile.test(val);   //mobile check
                                if(tmp)
                                        login['username']['type'] = 'mobile';
                        }
                        return tmp;
                },
                password: function(input_obj,reg){
                        var 
                        iobj = input_obj,
                        ipt = iobj.ipt,
                        val = iobj.ipt.value,
                        tmp = true,
                        level = (val.length>7) ? 0 + (val.length>7) + (/[a-z]/.test(val) && /[A-Z]/.test(val)) + (/\d/.test(val) && /\D/.test(val)) + (/\W/.test(val) && /\w/.test(val)) + (val.length > 12) : 0;  //level  0  1  2  3  4  password stronger
                        if(val.length>20||/\s/.test(val)) level=0; //不包括空格
                        if(level==0||!level){
                                tmp = false;
                        }
                        login['password']={};
                        login['password']['level']=level;
                        return tmp;
                }
        }

         //预处理
        var __pre = function(name,api,cb){                
                var opts = {};
                opts[name] = api;
                opts[null] = [cb];
                init(login,opts);
        }

        //预处理回调
        var __aft = {
                'username' : function(){
                        var 
                        tmp = true;
                        inputs = getFormData(),
                        ipt = inputs['username']['ipt'];
                        tip = inputs['username']['tip'];
                        if(login['pre_username']){
                                var ajaxdata = login['pre_username'];
                                if(ajaxdata.status<0) {
                                        tmp=false;
                                        $(tip).addClass('show');
                                } else{
                                        switch(ajaxdata.status){
                                                case 0 :
                                                        $(ipt).addClass('u-verified');                        
                                                break;                                        
                                                case  1 :
                                                        $(tip).html('邮箱已被注册').addClass('show');
                                                        $(ipt).addClass('u-error').removeClass('u-verified');
                                                break;
                                                case  2 :
                                                        $(tip).html('手机已被注册').addClass('show');
                                                        $(ipt).addClass('u-error').removeClass('u-verified');
                                                break;
                                        }
                                }
                                if(ajaxdata.status>0)  tmp=false;
                                else {
                                        tmp=true;
                                        login['ultimate']['username']=tmp;
                                }
                        }
                        return tmp;
                },
                'pclogin' : function(){
                        var inputs = getFormData();
                        if(login['pre_pclogin']){
                                var data = login['pre_pclogin'];
                                if(data.status||data.status == 0){       
                                        if (data.status == 1) {
                                                //iframe
                                                if (top.location != self.location){
                                                        top.location.href=data.jump;        
                                                }else{
                                                        tips('登录成功，感谢有您!');
                                                        location.href = data.jump;
                                                }
                                        } else if (data.status == 0) {
                                                //用户名不存在  或者 // //密码错误                                            
                                                if(data.field_name!==''){
                                                        tipBehavior('username',false,'用户名或密码错误');
                                                }  
                                                if(data.need_verify==1){
                                                        $('#verify-filed').removeClass('hide');
                                                }                                                
                                        }else {
                                                tipBehavior('username',false,'请输入正确的邮箱或手机号');
                                        }
                                }
                        }
                        $('.changeCode').trigger('click');
                },
                'verify' : function(){
                        var 
                        tmp = true;
                        inputs = getFormData(),
                        ipt = inputs['verify']['ipt'];
                        tip = inputs['verify']['tip'];
                        if(login['pre_verify']){
                                var data = login['pre_verify'];
                                if(data.status!=0){
                                        $(tip).addClass('show');
                                        $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                                        $('.changeCode').trigger('click');
                                        tmp=false;
                                }else{
                                        tmp=true;
                                        login['ultimate']['verify']=tmp;
                                        if(login['ultimate']['submit']){
                                                do_action('delaySubmit');
                                        }
                                }
                        }
                        return tmp
                }
        }       

        //On the result of validate input value, do something
        function tipBehavior(name,booler,prompt){
                var
                inputs = getFormData(),
                ipt = inputs[name] ? inputs[name]['ipt'] : '',
                tip = inputs[name] ? inputs[name]['tip'] : '';
                ptip = inputs[name] ? inputs[name]['ptip'] : '';

                //public tip method
                function commonTip(msg){
                        if(booler){
                                $(ipt).removeClass('u-error').removeClass('u-verified-err').addClass('u-verified');
                                $(tip).removeClass('show');
                                $(ptip).removeClass('show');
                        }else{
                                msg ? $(tip).html(msg).addClass('show') : $(tip).addClass('show') 
                                $(ipt).addClass('u-error').removeClass('u-verified').addClass('u-verified-err');
                        }
                }

                if(name=='username'){
                        prompt ? commonTip(prompt) : commonTip() ;
                        if(booler){
                                // if need async then use the fllow;

                                //  if  login['ultimate']['submit']=true , the submit opration right will change to async callback, 
                                //  the function in __aft['xxx']
                                // login['ultimate']['username'] = false;
                                // login['ultimate']['submit']=false;

                                //get data from back-end that to deal with
                                // api = {url:'/',data:{'ctl':'ajax' , 'act':'check_email_and_mobile' , 'email' : ipt.value, 'type':login['username']['type'] ,'async' : false}};
                                // __pre('pre_username', api, __aft['username']); 
                        }
                }
                if(name=='verify'){
                        commonTip();
                        if(booler){
                                //  if  login['ultimate']['submit']=true , the submit opration right will change to async callback, 
                                //  the function in __aft['xxx']
                                login['ultimate']['verify'] = false;
                                login['ultimate']['submit']=false;

                                //get data from back-end that to deal with
                                api = {url:'/',data:{'ctl':'ajax' , 'act':'check_email_and_mobile' , 'verify' : ipt.value ,'async' : false}};
                                __pre('pre_verify', api, __aft['verify']); 
                        }
                }
        }

         /*
        *  bind input element default event method
        *  click, blur, keyup
        */
        function bindInputDefaultEvent(){
                var 
                inpt,
                tmp,
                inputs = getFormData();

                //verify code refrash
                $('.changeCode').bind('click',function(){
                        var timenow = new Date().getTime();
                        $('#verify_image1').attr("src", "verify.php?rand=" + timenow);
                });

                // .u-ipt is css class of input
                $('.u-ipt').bind('focus',function(){
                        $(this).siblings('.u-placeholder').addClass('hide');
                });
                $('.u-ipt').bind('blur',function(){                        
                        if(!this.value)
                                $(this).siblings('.u-placeholder').removeClass('hide');
                });
                // input prompt
                $('.u-placeholder').click(function(){
                        $(this).siblings('.u-ipt').trigger('focus');
                });


                for(var ipt in inputs){
                        var inpt = inputs[ipt]['ipt']; 
                        (function(ele){
                                var 
                                ipt = inputs[ele]['ipt'],
                                tip =    inputs[ele]['tip'],
                                ptip = inputs[ele]['ptip'],
                                api ;

                                if(ele=='username'){
                                        //blur  behavior  will  valide form then check back-end data and deal with
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide(chkopts)
                                               (inputs[ele],'username')
                                               ();
                                                //valide behavior
                                                tipBehavior('username',tmp);
                                        });
                                }
                                if(ele=='verify'){
                                        $(ipt).bind('blur',function(){
                                                //form valide
                                               tmp = formValide({'popmsg':false})
                                               (ipt.value,'verify')
                                               ();
                                               //valide behavior
                                               tipBehavior('verify',tmp);
                                        });
                                }
                        })(ipt)
                }
        }

        bindInputDefaultEvent();

        //ultimate submit   second
       function checkAndPostForm(){
                var inputs = getFormData();
                var user_type = true;
                
                user_type = formValide(chkopts)
                                                             (inputs['username'], 'username')
                                                             ();
                if(user_type){
                         function delaySubmit(){
                                var tmp = true;
                                for(var stat  in login['ultimate']){
                                       if(!login['ultimate'][stat])
                                               tmp = false;
                                }
                                if(tmp)
                                        do_action('loginto');
                                else{
                                        tips('请正确填写注册信息', 'alert');
                                        $('.changeCode').trigger('click');
                                }
                         }
                         setTimeout(delaySubmit, 600);
                         add_action('delaySubmit', delaySubmit);
                }else{
                        tips('请正确填写登录信息', 'alert');
                }

       }

       function submitLogin(){
                var inputs = getFormData();
                var query={
                        email            : inputs['username']['ipt'].value,
                        user_pwd    : $.base64.encode(inputs['password']['ipt'].value),
                        auto_login  : $('#agree_userterm').val(),
                        ajax               :1
                };
                if(!$('#verify-filed').hasClass('hide')){
                        query['verify'] =  inputs['verify']['ipt'].value;
                }

                api = {"url" : login_url, data : query };
                __pre('pre_pclogin' , api , __aft['pclogin']); 
       }

       add_action('loginto',submitLogin);

        //校验
       $('.submit-btn').click(function(){
                //change the submit opration right to __aft['xxx']  function
                login['ultimate']['submit']=true;

                checkAndPostForm();
       });

       $('.plusLink').click(function(){
            $(".moreLinksBox").toggleClass("hide");
            $(this).toggleClass("plusLinkOn");
       });


    if (top.location != self.location){
                $('.container').removeClass('container').removeClass('bg-reg');
                $('.reg-content').removeClass('reg-content').css({'float':'none','width':'326px'});
                $('.auth-tips:first').removeClass('auth-tips').addClass('auth-tips-top');
                $('.auth-tips-top').addClass('hide');
                $('.response').hide();
                $('.response_title').removeClass('reg-title').removeClass('register-tit').html('');
                $('#main').css('background','none')
       }



</script>
</body>
</html>